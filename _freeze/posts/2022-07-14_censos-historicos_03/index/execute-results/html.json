{
  "hash": "13b143c519b1048a6558ebf5d1c8384a",
  "result": {
    "markdown": "---\ntitle: \"Municipios españoles más poblados (1842-2021) \"\ndate: 2022-07-14\ncategories: [datos INE, Censos históricos, población, municipios]\ncss: assets/my_css_file.css \ndraft: false\nimage: \"imagenes/thumbnail.jpg\"\n---\n\n\n\nUtilizando datos de los censos históricos y del Padrón, se presentan visualizaciones del ranking de ciudades españolas más pobladas desde el censo de 1842 hasta la actualidad. (Post provisional!!!) Work in progress!!!\n\n\n<br>\n\n## Introducción\n\nTambién haré posts de:\n\n- importancia histórica de las provincias (en cuanto a población)\n- importancia histórica de las capitales de provincia (en su provincia)\n- ¿Está más concentrada la población ahora que antes? 50% de la población de España\n\n\nPero antes he de \n\n- Aprender bien Quarto y escribir el primer post\n\n- Escribir post sobre sesgo de genero en premios literarios en Spain \n\n\n## Ranking de municipios más poblados\n\nVoy a mostrar en una tabla y un gráfico el ranking de los municipios mas poblados en cada censo. Mostrare solo los municipios que en alguno de los censos haya estado entre los 20 municipios mas poblados. Para que la tabla y los gráficos se vean razonablemente bien voy a mostrar los resultados de solo algunos de los censos y los datos actuales con datos del Padrón de 2021.\n\n### Tabla\n\n\n\n\n\n::: {.cell .column-page}\n::: {.cell-output-display}\n::: {.cell}\n\n```{.r .cell-code}\n# Post censos históricos\n# Objetivo: ver que capitales de provincia estuvieron en algún momento entre las 10 más pobladas\nlibrary(tidyverse)\n\n# cargo censos históricos \ndf <- pjpv.datos.2022::ine_censos_historicos\n\n# fusiono con datos de padrón 2021 \ndf_padron <- pjpv.curso.R.2022::ine_pob_mun_1996_2021 %>% \n  filter(year == 2021) %>% filter(poblacion == \"Total\") %>% \n  select(- poblacion, - ine_muni.n.orig) %>% \n  rename(pob = values) %>% \n  select(ine_muni, year, pob)\n\n# quito municipios de 2021 que no estan en df (1842-2011)\ndf_padron <- df_padron %>% filter(ine_muni %in% unique(df$ine_muni))\n\n# pongo a df las v. q van a hacer falta (ine_prov etc ....\nzz <- df %>% select(ine_muni, ine_muni.n.h, ine_prov, ine_prov.n, ine_ccaa, ine_ccaa.n, capital_prov, capital_ccaa, year) %>% filter(year == 2011) %>% select(-year)\ndf_padron <- left_join(df_padron, zz)\n\n\n# fusiono censos y padrón OK \ndf <- full_join(df, df_padron)\nzz <- df %>% filter(ine_muni == \"28079\")\nzz <- df %>% filter(ine_muni.n.h == \"Pancrudo\")\n\n\n# calculo rankings (para cada censo)\ndf <- df %>%\n  #select(year, ine_muni, ine_muni.n, pob, ine_prov)  %>%\n  group_by(year) %>%\n  arrange(desc(pob), desc(lag(pob)) )  %>%\n  mutate(rank_1 = 1:n(), .after = pob) %>%\n  mutate(rank_2 = dplyr::dense_rank(desc(pob))) %>%\n  ungroup() %>% \n  arrange(year)\n\n# calculo tb variaciones en el ranking\ndf <- df %>%\n  group_by(ine_muni) %>%\n  arrange(year) %>%\n  mutate(rank_dif_1 = lag(rank_1) - rank_1, .after = rank_1) %>% \n  mutate(rank_max_dif_1 = \n           max(rank_1, na.rm = TRUE) - min(rank_1, na.rm = TRUE), \n         .after = rank_dif_1) %>% ungroup()\n  \nzz <- df %>% filter(ine_muni.n.h == \"Teruel\")\n\n\n\n# calculo de crecimientos etc....\ndf <- df %>%\n  group_by(ine_muni) %>%\n  arrange(year) %>%\n  dplyr::mutate(pob_incre = pob - lag(pob)) %>%\n  dplyr::mutate(pob_percent = pob_incre / lag(pob) * 100) %>%\n  dplyr::mutate(qq_years = year - lag(year)) %>%\n  dplyr::mutate(pob_percent_acu = cumsum(coalesce(pob_incre,0)/first(pob)*100)) %>%\n  dplyr::mutate(qq_years_acu = cumsum(ifelse(is.na(qq_years), 0, qq_years))) %>%\n  dplyr::mutate(crec_percent_medio = pob_percent/qq_years) %>% \n  dplyr::mutate(crec_percent_medio_acu = pob_percent_acu/qq_years_acu) %>% \n  relocate(c(ine_prov, ine_prov.n), .after = last_col()) %>% ungroup\n\nzz <- df %>% filter(ine_muni.n.h == \"Teruel\")\n\n\n# veamos q capitales de prov. han estado alguna vez entre las 10 más pobladas\nqq_mas_pobladas <- 20\nzz <- df %>%\n  filter(rank_1 <= qq_mas_pobladas) %>%\n  distinct(ine_muni, ine_muni.n.h) %>% pull(ine_muni.n.h) #%>% print()  # 17 ciudades (cuidado con filtrar x nombre)\n\nzz <- df %>%\n  filter(rank_1 <= qq_mas_pobladas) %>%\n  distinct(ine_muni, ine_muni.n.h)  # xx ciudades (cuidado con filtrar x nombre)\n#print(zz$ine_muni.n.h)\n\n# filtremos, quedémonos con los datos de esas xx ciudades\ndf_table <- df %>% filter(ine_muni %in% zz$ine_muni)   # ok\n\n\n# Tablas ----------------------------------------------------------------------\n# nos quedamos con las 3 v. q queremos mostrar\ndf_table <- df_table %>%\n  select(ine_muni.n.h, year, rank_1)\n\n# hay q pasar la df_table a formato ancho (2 posibilidades)\ndf_t1 <- df_table %>% tidyr::pivot_wider(names_from = year, values_from = rank_1)\ndf_t2 <- df_table %>% tidyr::pivot_wider(names_from = ine_muni.n.h, values_from = rank_1)\n\n# hay muchos pkgs para tablas\n# DT::datatable(df_t1)\n# gt::gt(df_t2)\n\n\n# gt: https://gt.rstudio.com/\n# gallery: https://community.rstudio.com/c/table-gallery/64\n# ejemplo: https://jelloque.github.io/trabajo_BigData/#5_LOS_CICLISTAS\n# otro: https://twitter.com/irg_bio/status/1486291227255451648?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1486291227255451648&ref_url=file%3A%2F%2F%2Fhome%2Fpjpv%2FEscritorio%2Fmys_COSAS%2Fmy_learn_RR%2Flearn_ggplot2%2Fejemplos_ggplot2_2022.html\n\n# gt::gt(df_t2) %>%\n#   gt::tab_header(title = \"Capitales más pobladas\",\n#     subtitle = glue::glue(\"{min(df$year)} to {max(df$year)}\"))\n\n# quito algunos censos para que las tablas se vean mejor\nzz <- df %>% distinct(year)\n\ndf_ok <- df_t1 %>% rename(municipio = ine_muni.n.h) %>% \n  select(municipio, `1842`, `1857`, `1877`, `1897`, `1910`, `1930`, `1950`, `1970`, `1991`, `2021`)\n\n# table_ok <- df_ok %>% \n#   reactable::reactable(defaultPageSize = 36, compact = TRUE,\n#                        filterable\t = TRUE, \n#                        theme = reactablefmtr::fivethirtyeight(cell_padding = 1, font_size = 11, header_font_size = 13)) \n# \n# table_ok\n# \n\n# mejoramos las tablas\n# DT: https://rstudio.github.io/DT/\nDT::datatable(df_ok, filter = 'top', extensions = \"Scroller\",\n              class = 'cell-border stripe',\n              options = list(autoWidth = TRUE,deferRender = TRUE,\n                             scroller = TRUE, scrollY = 750 ))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-0beb60fafb8effff98f9\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0beb60fafb8effff98f9\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"1082\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"1082\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"957\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"720\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"587\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"101\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"123\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"227\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"253\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"integer\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1\\\" data-max=\\\"313\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Scroller\"],\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\"],[\"Madrid\",\"Barcelona\",\"Sevilla\",\"Murcia\",\"Málaga\",\"Valencia\",\"Granada\",\"Cádiz\",\"Lorca\",\"Córdoba\",\"Palma\",\"Cartagena\",\"Jerez de la Frontera\",\"Zaragoza\",\"Reus\",\"Caravaca de la Cruz\",\"Écija\",\"Santiago de Compostela\",\"Tortosa\",\"Alcoy / Alcoi\",\"Oviedo\",\"Coruña, A\",\"Valladolid\",\"Alacant / Alicante\",\"Elche / Elx\",\"Almería\",\"Palmas de Gran Canaria, Las\",\"Santander\",\"Gijón\",\"Bilbao\",\"Donostia - San Sebastián\",\"Vitoria-Gasteiz\",\"Santa Cruz de Tenerife\",\"Vigo\",\"Badalona\",\"Hospitalet de Llobregat, L'\"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,29,32,40,41,109,113,121,168,232,623,1082],[1,2,3,6,5,4,8,7,13,14,11,10,12,9,18,81,17,23,28,27,26,20,15,19,44,22,82,16,29,54,68,50,97,123,148,1082],[1,2,4,6,5,3,8,10,14,15,11,9,12,7,28,93,33,41,39,23,21,18,13,19,59,17,70,16,26,20,50,29,76,120,105,957],[1,2,4,6,5,3,9,11,14,16,13,8,15,7,36,105,51,44,46,30,20,22,12,18,34,19,25,17,21,10,23,29,27,93,75,720],[2,1,4,6,5,3,10,14,11,15,13,8,17,7,53,99,66,57,47,32,22,23,12,20,37,24,19,16,21,9,25,31,18,26,80,587],[2,1,4,7,5,3,9,18,26,11,13,10,20,6,64,101,68,40,52,42,16,21,12,22,50,27,17,14,15,8,19,38,25,24,34,55],[1,2,4,7,5,3,10,24,29,9,13,16,19,6,73,123,60,49,55,58,22,14,15,21,43,27,11,23,18,8,17,54,20,12,37,30],[1,2,4,9,7,3,16,29,60,12,13,26,23,5,61,227,106,55,77,58,22,15,11,18,31,34,8,24,17,6,20,30,27,14,19,10],[1,2,4,10,6,3,17,37,79,11,12,31,27,5,57,253,143,56,174,81,22,18,9,15,26,36,8,24,16,7,29,20,21,13,19,14],[1,2,4,7,6,3,20,57,67,12,8,24,26,5,59,313,178,65,227,127,23,18,13,11,19,30,9,39,15,10,33,17,28,14,22,16]],\"container\":\"<table class=\\\"cell-border stripe\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>municipio<\\/th>\\n      <th>1842<\\/th>\\n      <th>1857<\\/th>\\n      <th>1877<\\/th>\\n      <th>1897<\\/th>\\n      <th>1910<\\/th>\\n      <th>1930<\\/th>\\n      <th>1950<\\/th>\\n      <th>1970<\\/th>\\n      <th>1991<\\/th>\\n      <th>2021<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"autoWidth\":true,\"deferRender\":true,\"scroller\":true,\"scrollY\":750,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5,6,7,8,9,10,11]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n:::\n:::\n\n\n\nPor hacer un mínimo comentario de los resultados mostrados en la tabla, señalar que Madrid ha estado siempre en el puesto 1 o 2, Hospitalet de LLobregat es el municipio (de los que en algún momento estuvo en el top 20) menos poblado en 1842. Caravaca de la Cruz era el 16º municipio por población en 1842 mientras que en 2021 ocupa el puesto 313.\n\n### Gráfico\n\nLas tablas están muy bien si necesitas sabes los valores exactos de una variable o si quieres ver algun detalle, pero para ver la evolución es mejor un gráfico.\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.22/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/dt-ext-scroller-1.11.3/css/scroller.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-ext-scroller-1.11.3/js/dataTables.scroller.min.js\"></script>\n<link href=\"../../site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"../../site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}